**RELEASE: r2040**

## Add additional fields to Money Transfer Audit Logs

*MR NUMBER:*                            ADMCSA-858

*DEVELOPER NAME:*                       [Ed Carr](Ed.Carr@idt.net)

*DATE:*                                 Thursday, July 19, 2018  3:10:06 PM EDT

*TARGET SERVER TYPES:*                  IVR VRU

*SOFTWARE MODULES:*                     ivrCallSvr


**FEATURE DESCRIPTION:**

The IVR Call Server and the IvrBRMoneyTransferCS menu create audit logs pertaining to the Money Transfer Status flow.  For successful status queries from the Money Transfer Micro-Server additional fields were requested to be part of the audit logs -- this is for events 360 & 361.  The following fields will be produced:

  - Payer Agent
  - Destination Country
  - Payment Method
  - Pay at Store Display Status

In addition, there will be additional substatuses produced on audit event 363 whenever a call decides to call  customer service.

---

- [ ] CONFIGURATION IMPACTS:

- [ ] OPS COMMAND IMPACTS:

- [ ] DB SCHEMA CHANGES:

- [ ] DB CONVERSION: 

- [ ] VOICE LIB IMPACTS:

- [ ] DNIS/CLASS IMPACTS:

- [x] MENU IMPACTS:

     The menu file: `IvrBRMoneyTransferCS.menu` will be modified.

- [ ] TBA

- [ ] ALARMS:

- [ ] OSS/MIS/BILLING/CDR IMPACTS:

- [ ] TLOG IMPACTS:

- [x] API IMPACTS:

  Additional fields on the 360/361 Audit Event:

  - "MT Payer Agent: <payerAgent>, "

  - "MT Destination Country: <destinationCountry>, "

  - "MT Payment Method: <paymentMethod>, "

  - "MT Pay At Store Status: <pasDisplayStatus>, ",

  where:
  
| Field                | Description                                                  |
| -------------------- | ------------------------------------------------------------ |
| <payerAgent>         | Is the name of the agency that sends the money.              |
| <destinationCountry> | Two letter ISO country id for the destination.               |
| <paymentMethod>      | Indicates what source was used to pay the fee.  That is, Cash, Credit Card (CC), Debit Card (DC), or Pay at Store (PAS). |
| <pasDisplayStatus>   | Indicates the substatus of the transaction if the <paymentMethod> was "Pay at Store" (PAS). |



***INSTALLATION INSTRUCTIONS:*** 								none

***COMPATABILITY ISSUES:***									none

***VERIFICATION PROCEDURE:***

​	For a quick verification use the following on an audit log generated by a successful tracking number query:

`grep :360: /u/debit/logs/audit.0`

​	For a quick verification use the following on an audit log generated by a successful customer phone number query:

`grep :361: /u/debit/logs/audit.0`

***TESTING SUMMARY FOR NON-QA-TESTED FEATURES:***			none



---



## Incorrect Fee is taken when Transaction is reversed multiple times

*MR NUMBER:*                            MVNO-1961

*DEVELOPER NAME:*                       [Michelle Wong](Michelle.Wong@idt.net)

*DATE:*                                 Mon Jul 23 15:41:27 EDT 2018

*TARGET SERVER TYPES:*                  debit database

*SOFTWARE MODULES:*                     debitSkSvrXML


**FEATURE DESCRIPTION:**

When transaction is created and reversed multiple times (for Pay@Store Accept/Reverse Payment), the Fee that is returned is taken randomly instead of taking the last one. For an example you can use pin: 1155336236 and Date: 7/9/2018 (QA)

---

- [ ] CONFIGURATION IMPACTS:
- [ ] OPS COMMAND IMPACTS:
- [ ] DB SCHEMA CHANGES:
- [ ] DB CONVERSION: 
- [ ] VOICE LIB IMPACTS:
- [ ] DNIS/CLASS IMPACTS:
- [ ] MENU IMPACTS:
- [ ] TBA
- [ ] ALARMS:
- [ ] OSS/MIS/BILLING/CDR IMPACTS:
- [ ] TLOG IMPACTS:
- [ ] API IMPACTS:



***INSTALLATION INSTRUCTIONS:*** 								none

***COMPATABILITY ISSUES:***									none

***VERIFICATION PROCEDURE:***

- createancxfer with fix transaction_id and a fee
- undocreateandxfer of previous transaction
- createandxfer with the same transaction_id and a different fee (soon after the first transation and its undo)
- undocreateandxfer of previous transaction
- verify that the undo pick up the latest transaction

	**TESTING SUMMARY FOR NON-QA-TESTED FEATURES:***			none
